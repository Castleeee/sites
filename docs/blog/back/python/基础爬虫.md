---
title: åŸºç¡€çˆ¬è™«
date: 2018-7-13 14:05:39
prev: false
next: ./scrapyç›¸å…³.md
categories: backEnd
tags:
- çˆ¬è™«ğŸ•·
- åç«¯
- ç¬¬ä¸‰æ–¹åº“
- pythonğŸ
- å¼‚æ­¥
- æ‰€æœ‰æ–‡ç« 
---
:::tip åŸºæœ¬çŸ¥é“çš„çˆ¬è™«
å¥½å¤šè‡ªå·±çœ‹å§
:::
<!-- more -->

## çˆ¬è™«çš„åŸºæœ¬åŸç†
åŸºæœ¬å°±æ˜¯ä¸‰éƒ¨åˆ†
### è¯·æ±‚
è¯·æ±‚å°±æ˜¯httpï¼ŒæŠŠç½‘é¡µçš„æºç ä¸‹è½½åˆ°æœ¬åœ°(å†…å­˜)è¿›è¡Œè®¿é—®çš„ï¼Œç»å¸¸ç”¨çš„æœ‰urlib(å¤ªè€ä¸€èˆ¬åªç”¨åˆ°urljoin)ï¼Œrequestsï¼Œscrapy(æ¡†æ¶)ï¼Œtwisted(å¼‚æ­¥äº‹ä»¶é©±åŠ¨)ï¼Œaiohttp(å¼‚æ­¥)
è¯·æ±‚ä¸€èˆ¬ç”¨get(ç›´æ¥è·å–èµ„æº)post(è¡¨å•éªŒè¯)setç­‰åé¢ä¸å¸¸ç”¨<br/>è¿™é‡Œä¼šæ¶‰åŠåˆ°åçˆ¬<br/>
- å¯¹ç½‘ç«™æ„Ÿå…´è¶£,åˆ†æç½‘ç»œè¯·æ±‚ï¼Œç”¨scrapyå†™çˆ¬è™«çˆ¬å–æ•°æ®<br/>
ç›‘æ§å‘ç°æŸä¸ªæ—¶é—´æ®µè®¿é—®é™¡å¢ï¼Œipç›¸åŒï¼Œuserag-entéƒ½æ˜¯pythonï¼Œç›´æ¥é™åˆ¶è®¿é—®ï¼ˆä¸èƒ½å°ipï¼‰
- User-agenæ¨¡æ‹Ÿfirefoxï¼Œè·å–ipä»£ç†<br/>
å‘ç°ipå˜åŒ–ï¼Œç›´æ¥è¦æ±‚ç™»å½•æ‰èƒ½è®¿é—®
- æ³¨å†Œè´¦å·ï¼Œæ¯æ¬¡è¯·æ±‚å¸¦cookieæˆ–è€…token<br/>
å¥å…¨è´¦å·ä½“ç³»ï¼Œå³Aåªèƒ½è®¿é—®å¥½å‹çš„ä¿¡æ¯
- æ³¨å†Œå¤šä¸ªè´¦å·ï¼Œå¤šä¸ªè´¦å·è”åˆçˆ¬å–<br/>
è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¿›ä¸€æ­¥åŠ å‰§ipè®¿é—®é¢‘ç‡é™åˆ¶
- æ¨¡ä»¿äººè¯·æ±‚ï¼Œé™åˆ¶è¯·æ±‚é€Ÿåº¦<br/>
å¼¹å‡ºéªŒè¯ç ï¼Œè®©è¯†åˆ«éªŒè¯ç 
- é€šè¿‡å„ç§æ‰‹æ®µè¯†åˆ«éªŒè¯ç <br/>
å¢åŠ åŠ¨æ€ç½‘ç«™ï¼Œæ•°æ®é€šè¿‡jsåŠ¨æ€åŠ è½½ï¼Œå¢åŠ ç½‘ç»œåˆ†æå¤æ‚åº¦ï¼Œå‘ç°å¤§é‡è¯·æ±‚åªè¯·æ±‚htmlï¼Œä¸è¯·æ±‚imageå’ŒCSS
- é€šè¿‡seleniumå’Œphantomjså®Œå…¨æ¨¡æ‹Ÿæµè§ˆå™¨æ“ä½œ<br/>
12æˆæœ¬å¤ªé«˜ï¼Œæ”¾å¼ƒäº†ï¼ï¼ï¼ï¼
### å¤„ç†
BS4,pyQuery,lxmlç­‰è§£æDOMå’Œæ–‡ä»¶æ¶‰åŠåˆ°å¯»æ‰¾å±æ€§å®šä½xpath,seletor,csså®šä½
æœ€åäº§ç”Ÿä¸€ä¸ªè‡ªå·±æƒ³è¦çš„æ•°æ®ç»“æ„
### å­˜å‚¨
æ‹¿åˆ°è¿™ä¸ªç»“æ„çš„æ—¶å€™ï¼Œå­˜åˆ°æ•°æ®åº“ã€‚<br/>
pymysql(æ¨è),aiomysql(å¼‚æ­¥),å­˜ä¸ºæ–‡ä»¶(FileIO)scrapyçš„pipline,æ¨é€æ¶ˆæ¯ç­‰ç­‰
twisted+pymysql(æ‰‹åŠ¨å¼‚æ­¥)while+eventloopé©±åŠ¨

### å»é‡
çˆ¬è™«å»é‡ç­–ç•¥
1. å°†è®¿é—®è¿‡çš„urlä¿å­˜åˆ°æ•°æ®åº“ä¸­
2. å°†è®¿é—®è¿‡çš„urlä¿å­˜åˆ°setä¸­ï¼Œåªéœ€è¦*O*(1)çš„ä»£ä»·å°±å¯ä»¥æŸ¥è¯¢urlæé™100000000\*2byte*50ä¸ªå­—ç¬¦/1024/1024/1024=9G
3. urlç»è¿‡md5ç­‰æ–¹æ³•å“ˆå¸Œåä¿å­˜åˆ°setä¸­
4. ç”¨bitmapæ–¹æ³•ï¼Œå°†è®¿é—®è¿‡çš„urlé€šè¿‡hashå‡½æ•°æ˜ å°„åˆ°æŸä¸€
5. bloomfilteræ–¹æ³•å¯¹bitmapè¿›è¡Œæ”¹è¿›ï¼Œå¤šé‡hashå‡½æ•°é™ä½å†²çª
:::danger ç•™å‘
å¸ƒéš†è¿‡æ»¤å™¨
:::
## è¯·æ±‚
### requests
requestçš„åŸºæœ¬ä½¿ç”¨<br/>
è¿”å›çš„æ˜¯ä¸€ä¸ª
ä¸€èˆ¬postä¹‹å‰è¦æŸ¥çœ‹ä¸€ä¸‹æ­£å¸¸çš„postæœ‰æ²¡æœ‰åŠ å¯†ï¼Œè¦ä¸è¦é‡å†™ï¼Œ
:::danger ç•™å‘
jsæ–­ç‚¹è°ƒè¯•fiddleræŠ“åŒ…
:::
#### get()&post()
1. get(url,å‚æ•°),å†™å›¾ç‰‡
è¿”å›çš„æ˜¯ä¸€ä¸ªresponseå¯¹è±¡ï¼ŒåŒ…å«çŠ¶æ€ç è¯·æ±‚æˆåŠŸä¸å¦ç­‰ç­‰
```py
    data={
        "name":"zhizhi",
        "age":20
    }
    files={"files":open("baidu.png","rb")}
    res=requests.get("http://www.httpbin.org/get",params=data)#æ„é€ ä¸€ä¸ªå‚æ•°å¹¶ä¼ è¿›å»
    print(res.text)#ç›´æ¥è¿”å›å­—ç¬¦ä¸²
    print(res.json())#ç›´æ¥è§£æjson
    print(res.contnet)#è¿”å›ç½‘é¡µåŸå§‹å†…å®¹
    print(res0.status_code)#è¯·æ±‚çš„çŠ¶æ€ç 
    res0.encoding="utf-8"#æŠŠç½‘é¡µçš„ç¼–ç è½¬æ¢
    res1=requests.get("https://www.baidu.com/img/bd_logo1.png")
    len(res1.content)#å›¾ç‰‡çš„äºŒè¿›åˆ¶
    with open("baidu.png","wb") as f:#å†™äºŒè¿›åˆ¶å›¾ç‰‡
        f.write(res1.content)
```
2. ä½¿ç”¨header
```py
headers={"Referer": "https://www.zhihu.com/signup?next=%2F","User-Agent":"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.102 Safari/537.36"}
res3=requests.get("https://www.zhihu.com",headers=headers)#æ·»åŠ headers,åƒæŸå‘¼è¿™ç§ä¸åŠ headerå°±ä¸ç»™è®¿é—®
print(res3.text)

```
3. ä¼ å…¥æ–‡ä»¶å¹¶ä½¿ç”¨cookie
<br/>dataè¢«ä¼ å…¥äº†cookieä¸­å¯ä»¥è®¿é—®äº†
```py
res4 = requests.post("http://www.httpbin.org/post", data=data,headers=headers, files=files)
 # æ„é€ ä¸€ä¸ªformå¹¶ä¼ è¿›å»
pprint(res4.text)
print(res4.cookies)
for k,v in res4.cookies:
    print(k,":",v)
```
4. sessionç»´æŒä¼šè¯ï¼Œä¸€èˆ¬sessionä¼šå¾ˆä¹…
```py
s=requests.session()#ç»´æŒä¼šè¯
s.get("http://www.httpbin.org/cookies/set/abc/svsvdhasb",verify=False)
# ä¸è¿›è¡Œè¯ä¹¦éªŒè¯ï¼Œå¯ä½¿ç”¨cert=("path/server.crt","path/ket")è¿›è¡Œè¯ä¹¦éªŒè¯
res5=s.get("http://www.httpbin.org/cookies")
print(res5.text)
```
5. ä½¿ç”¨ipä»£ç†
å¸¸ç”¨çš„ä»£ç†æœ‰è¥¿åˆºä¹Ÿå¯ä»¥è‡ªå·±ä¹°
```py
proxies={"https":"127.0.0.1:9900"}#ä½¿ç”¨ä»£ç†
res6=requests.get("http://www.httpbin.org/get",proxies=proxies)
print(res6.content)
```
### selenium
seleniumæµè§ˆå™¨é©±åŠ¨ã€‚<br/>å½“æŸäº›ç½‘é¡µåŠ¨æ€åŠ è½½jsçš„æ—¶å€™(æ·˜å®)æˆ‘ä»¬éœ€è¦ç¨‹åºå»æ‰§è¡Œjsï¼Œ(æ•ˆç‡è‡ªç„¶ä¼šä½ä¸€äº›)è¿™å°±æ˜¯seleniumçš„ä½œç”¨
phantomjs(æ— ç•Œé¢æµè§ˆå™¨)ä¹Ÿè¡Œä½†æ˜¯åœ¨å¤šè¿›ç¨‹çš„æƒ…å†µä¸‹æ€§èƒ½ä¸‹é™ä¸¥é‡ã€‚
<br/>
ä½¿ç”¨ä¹‹å‰å…ˆä¸‹è½½ä¸€ä¸ªdriver<a href='https://npm.taobao.org/mirrors/chromedriver/2.34/'>æ·˜å®é•œåƒ</a>
```py
from selenium import webdriver
broswer.get('http://www.baidu.com')#æ‰“å¼€
print(broswer.page_source) # æ‹¿åˆ°F12çš„ä»£ç (ç»è¿‡æ¸²æŸ“çš„)
broswer.maximize_window()#æœ€å¤§åŒ–çª—å£
broswer.set_window_size(600,800)#è®¾ç½®çª—å£å¤§å°
broswer.back()#åé€€ä¸€æ­¥
broswer.forward()#å‰è¿›ä¸€æ­¥
broswer.refresh()#åˆ·æ–°
print(broswer.title)#æ‹¿åˆ°æµè§ˆå™¨çš„æ ‡é¢˜
print(broswer.current_url)#æ‹¿åˆ°url
broswer.get_cookies()#æ‹¿åˆ°cookie
broswer.delete_all_cookies()#åˆ é™¤æ‰€æœ‰çš„cookie
broswer.add_cookie({k-v})#å¢åŠ cookie
```
:::tip å¯ç”¨çš„é©±åŠ¨
webdriver.Firefox<br/>
webdriver.FirefoxProfile<br/>
webdriver.Chrome<br/>
webdriver.ChromeOptions<br/>
webdriver.Ie<br/>
webdriver.Opera<br/>
webdriver.PhantomJS<br/>
webdriver.Remote<br/>
webdriver.DesiredCapabilities<br/>
webdriver.ActionChains<br/>
webdriver.TouchActions<br/>
:::
#### æŸ¥æ‰¾å…ƒç´ 
ä¸å»ºè®®ä½¿ç”¨è‡ªå¸¦çš„ï¼Œå› ä¸ºä¼šæ‹–æ…¢é€Ÿåº¦ï¼Œæ€§èƒ½ä¼šå˜å·®ã€‚<br/>
å¯ä»¥ç”¨å…¶ä»–çš„åŒ…lxml bsç­‰ä»£æ›¿ï¼Œä¸è¿‡æœ‰æ—¶å€™ä¸èƒ½ä»£æ›¿
```py
print(broswer.find_element_by_id(id_="lg"))
```
1. idå®šä½ï¼šfind_element_by_id()
2. nameå®šä½ï¼šfind_element_by_name()
3. classå®šä½ï¼šfind_element_by_class()
4. tagå®šä½ï¼šfind_element_by_tag_name()
5. linkå®šä½ï¼šfind_element_by_link_text()
6. partial link å®šä½ï¼š find_element_by_partial_link_text()
7. Xpathå®šä½:<br/>
    - ç»å¯¹è·¯å¾„ï¼šfind_element_by_xpath("ç»å¯¹è·¯å¾„")
    - å…ƒç´ å±æ€§ï¼šfind_element_by_xpath("//unput[@id='kw']")
    - å±‚çº§ä¸å±æ€§ç»“åˆï¼šfind_element_by_xpath("//form[@id='loginForm']/ul/input[1]")
    - é€»è¾‘è¿ç®—ç¬¦ï¼šfind_element_by_xpath("//input[@id='kw' and@class='s_ipt']")
8. CSSå®šä½ï¼šfind_element_by_css_selector()
#### é€šè¿‡seleniumæ¨¡æ‹Ÿç™»é™†å¾®åš
:::danger å¤±è´¥äº† ç•™å‘
åé¢å†è¯•ï¼Œå¡«å€¼çš„æ—¶å€™å¡«ä¸ä¸Š
:::
<h4> å¾€å…ƒç´ ä¸­å¡«å€¼å¹¶ç™»é™†</h4>

```py
ele0=broswer.find_element_by_id(id_="lg")
ele=broswer.find_element_by_id(id_="kw")
ele.send_keys(u"qwe")#æ¨¡æ‹ŸæŒ‰é”®è¾“å…¥ï¼š
ele.clear()#æ¸…é™¤æ–‡æœ¬ï¼š
ele.send_keys(u"abc")#æ¨¡æ‹ŸæŒ‰é”®è¾“å…¥ï¼š
ele1=broswer.find_element_by_class_name("bg s_btn")
ele1.click()#å•å‡»å…ƒç´ 
ele1.submit()#æäº¤è¡¨å•ï¼ˆç›¸å½“äº"å›è½¦"ï¼‰
broswer.execute_script('alert("123");')#æ‰§è¡Œjs
```
åŠ è½½çš„æ—¶å€™ä¸åŠ è½½å›¾ç‰‡(èŠ‚çœæ€§èƒ½)ï¼Œå¦‚ä¸‹è®¾ç½®

```py
from selenium import webdriver

chrome_options = webdriver.ChromeOptions()
prefs = {"profile.managed_default_content_settings.images":2}
chrome_options.add_experimental_option("prefs",prefs)

driver = webdriver.Chrome(chrome_options=chrome_options)

```
### aiohttp
å¼‚æ­¥è¯·æ±‚çš„httpåº“
:::danger ç•™å‘
å¼‚æ­¥ç­‰è¿‡ä¸€ä¸¤å¤©å†æ•´ç†
:::
## å¤„ç†
æ•°æ®å¤„ç†å°±æ˜¯æŠŠDOMçš„å…ƒç´ å†…å®¹æ‹¿å‡ºæ¥
### BeautifulSoup
å¯¹domè¿›è¡Œè§£æ<br/>
from bs4 import BeautifulSoup as BS <br/>
domä¾‹å­

          <li id="note-36396362" data-note-id="36396362" class="have-img">
              <a class="wrap-img" href="www.baidu.com" target="_blank">
                <img class="  img-blur-done" src="//upload-images.jianshu.io/upload_images/12240181-bb9399878eae6ddd?imageMogr2/auto-orient/strip|imageView2/1/w/360/h/240" alt="120">
              </a>
            <div class="content">
              <a class="title" target="_blank" href="www.baidu.com">ç½—æ°¸æµ©æœ€çˆ±çš„â€œè½¯ä»¶â€ä¸‹å‡¡äº†ï¼ è®©ä½ ä½“éªŒé«˜æ•ˆè®°å½•çš„æ„Ÿè§‰</a>
              <p class="abstract">
                å¬è¯´é”¤å­åˆå‘å¸ƒäº†æ–°äº§å“ï¼ é”¤å­ç§‘æŠ€ä¸æ˜¯ä¸€ä¸ªå–æ‰‹æœºçš„å¥½å…¬å¸ï¼Œå´æ˜¯ä¸€ä¸ªæè½¯ä»¶çš„é¢†å¤´å†›ï¼Œæ——ä¸‹çš„é—ªå¿µèƒ¶å›Šå’ŒBigBangä¸€ç›´è¢«èµæ‰¬ï¼Œç½‘å‹æˆç§°ï¼š é”¤å­æœ‰ä¸‰...
              </p>
              <div class="meta">
                <a class="nickname" target="_blank" href="/u/00385c37e5de">ToolsæŒ‡å—</a>
                  <a target="_blank" href="www.baidu.com#comments">
                    <i class="iconfont ic-list-comments"></i> 3
          </a>      <span><i class="iconfont ic-list-like"></i> 46</span>
              </div>
            </div>
          </li>



```py
from bs4 import BeautifulSoup as BS
soup=BS(dom,'lxml')#ç”Ÿæˆäº†ä¸€ä¸ªsoupå¯¹è±¡ä½¿ç”¨unicodeç¼–ç 
```
:::tip æ³¨æ„æŒ‡å®šç¼–ç 
é»˜è®¤lxml<br/>
BeautifulSoup(markup, "lxml")é€Ÿåº¦å¿«<br/>
BeautifulSoup(markup, "html.parser")ç³»ç»Ÿè‡ªå¸¦<br/>
BeautifulSoup(markup, "xml")å”¯ä¸€æ”¯æŒxml<br/>
BeautifulSoup(markup, "html5lib")ç”Ÿæˆh5æµè§ˆå™¨æ–¹å¼è§£æ
:::
tag.nameæ ‡ç­¾åç§°å¯åµŒå¥—soup.head.tittle<br/>
tag.attributesæ ‡ç­¾åé¢çš„å±æ€§,å¯æ·»åŠ æˆ–è€…ä¿®æ”¹,å’Œå­—å…¸ä¸€æ ·<br/>
å¤šå€¼å±æ€§,classæœ€å¤š,æ¯ä¸ªtagå¯èƒ½ç”¨å¤šä¸ªcss<br/>
å…¶ä»–çš„rel , rev , accept-charset , headers , accesskeyè¿”å›ä¸€ä¸ªlistéå¤šå€¼å±æ€§ä¼šè¿”å›str<br/>
å°†tagè½¬æ¢ä¸ºstrçš„æ—¶å€™å¤šå€¼å±æ€§ä¼šè‡ªåŠ¨åˆä¸ºç”±ç©ºæ ¼éš”å¼€çš„å­—ç¬¦ä¸²,xmlæ²¡æœ‰å¤šå€¼
```py
print(soup.name,soup.attrs)#è·å–åå­—å’Œå±æ€§
print(soup.find(class_="meta"),#è·å–äº†classä¸ºmetaçš„ç¬¬ä¸€ä¸ªå…ƒç´ 
soup.find_all_next(class_="meta"),#è·è¿™ä¹Ÿå…ƒç´ çš„ä¸‹ä¸€ä¸ªé‚»å±…
soup.find_all(class_="meta"))#åˆ—è¡¨è·å–æ‰€æœ‰metaçš„å…ƒç´ 
tag.parent#è·å¾—çˆ¶èŠ‚ç‚¹beautifulsoupçˆ¶èŠ‚ç‚¹ä¸ºNone
tag.descendants#å­å­™èŠ‚ç‚¹çš„é€’å½’è¿­ä»£å¯¹è±¡
tag.chlidren#æ˜¯åŒ…å«å­èŠ‚ç‚¹å¯¹è±¡å¯¹è±¡å¯¹è±¡çš„å¯è¿­ä»£å¯¹è±¡
```

| æ–¹æ³•      | å‚æ•°          | è¿”å›  |
| ------------- |:-------------:| -----:|
| find     | (self, name, attrs, recursive, text,.â€¦ Tag | 1 |
| find_all      |   (self, name, attrs, recursive, te.. Tag   |   2 |
| find_all_previous |   (self, name, att.. PageElement    |    3 |
|find_next   |  (self, name, attrs, text.. PageElement| 4 |
| find_next_sibling     |   (self, name, att.. PageElement   |   5 |
| find_next_siblings |   (self, name, at.. PageElement    |    6 |
| find_parent    | (self, name, attrs, kw.. PageElement |7|
| find_parents      |  (self, name, attrs,1.. PageElement   |   8 |
| find_previous |   (self, name, attrs,.. PageElement   |   9 |
| find_previous_sibling     |  (self, name,.â€¦ PageElement    |   10 |
| find previous siblings |   (self, name.. PageElement   |   11 |

è¿™æ˜¯èŠ‚ç‚¹çš„ä¸€äº›å±æ€§ï¼Œå¯ä»¥è·å–å†…å®¹

:::warning
æ³¨æ„é¡¿å·ä»¥åŠæ¢è¡Œä¹Ÿç®—èŠ‚ç‚¹<br/>
class_ç”¨æ¥æ ‡è¯†csså¯ä»¥éƒ¨åˆ†åŒ¹é…ä¹Ÿå¯å…¨åŒ¹é…,å…¨åŒ¹é…çš„æ—¶å€™æ³¨æ„é¡ºåºè‹¥ä¸ä¸€æ ·æ— æ³•åŒ¹é…
:::


```py
print(soup.find(class_="meta"),#è·å–äº†classä¸ºmetaçš„ç¬¬ä¸€ä¸ªå…ƒç´ 
soup.find_all_next(class_="meta"),#è·è¿™ä¹Ÿå…ƒç´ çš„ä¸‹ä¸€ä¸ªé‚»å±…
soup.find_all(class_="meta"),)
soup1=soup.find(name='p',class_="abstract")#è·å–æ ‡ç­¾ä¸ºpï¼Œclass="abstract"çš„å…ƒç´ 
print(soup.string)#æ²¡æœ‰å­èŠ‚ç‚¹çš„æƒ…å†µä¸‹å¾—åˆ°å­—ç¬¦ä¸²
print(soup1.strings)#å¾—åˆ°å¤šä¸ªå­—ç¬¦ä¸² åˆ—è¡¨
soup1=soup.find(name="div",class_="content")
print(soup1.contents)#èŠ‚ç‚¹çš„å…ƒç´ ï¼Œæ˜¯ä¸ªåˆ—è¡¨
soup.get_text()#è¿”å›æ‰€æœ‰çš„åŠå…¶å­©å­çš„æ–‡æœ¬
soup.prettify()#è‡ªåŠ¨å¯¹é½è¡¥å…¨html
```

### pyQuery
pipå®‰è£…pyQuery

<h3>æ‰“å¼€</h3>

pq=PyQuery("http://www.baidu.com")#ä¹Ÿå¯ä»¥ç›´æ¥æ‰“å¼€æ–‡ä»¶pq=PyQuery("aa.html")


| ç±»å‹      | å½¢å¼          | å«ä¹‰  |
| ------------- |:-------------:| -----:|
| .class     | .color | é€‰æ‹©class="colorâ€çš„æ‰€æœ‰å…ƒç´  |
| #id      |   #info   |   é€‰æ‹©id="infoâ€çš„æ‰€æœ‰å…ƒç´  |
| *|   *    |    é€‰æ‹©æ‰€æœ‰å…ƒç´  |
|element   |  p| é€‰æ‹©æ‰€æœ‰çš„på…ƒç´ |
| element,element| div,pe|é€‰æ‹©æ‰€æœ‰divå…ƒç´ å’Œæ‰€æœ‰på…ƒç´ |
| elemente lement| div pe|é€‰æ‹©æ‰€æœ‰divå…ƒç´ å†…æ‰€æœ‰på…ƒç´ |
|\[attribute]|[target]|é€‰æ‹©å¸¦æœ‰targeå±æ€§çš„æ‰€æœ‰å…ƒç´ ã€‚|
|[arrtibute=value]|[target=_blank]|é€‰æ‹© target="_blankâ€çš„æ‰€æœ‰å…ƒç´ |

å¯ä»¥ä½¿ç”¨ä¼ªç±»<br/>
å¯è°ƒç”¨çš„å‡½æ•°<br/>
- pq.find()#å‘ç°æ ‡ç­¾
- pq.parent()#å‘ç°æ ‡ç­¾çš„çˆ¶æ ‡ç­¾
- pq.parents()#é€’å½’å‘ç°çˆ¶æ ‡ç­¾
- pq.children()#å‘ç°å­æ ‡ç­¾
- pq.text()#è·å–æ‰€æœ‰æ–‡æœ¬,å¿½ç•¥æ ‡ç­¾

:::warning
pqæœ¬èº«æ˜¯å…·æœ‰æ ‡ç­¾çš„å­—ç¬¦ä¸²
pq.html()ä¸å«æœ¬èº«çš„æ ‡ç­¾
:::
ç¨‹åºå¦‚ä¸‹<br/>
```py
ä½¿ç”¨ä¸Šé¢çš„dom
x=pq('li a')
pq.find('a')
pq.parent('a')
pq.parents('a')
pq.children('a')
print(x.attr("target","_blank"))
print(x.attr.target)
print(x.text())
```
ç»“æœ



    <a class="wrap-img" href="www.baidu.com" target="_blank">
          <img class="  img-blur-done" src="//upload-images.jianshu.io/upload_images/12240181-bb9399878eae6ddd?imageMogr2/auto-orient/strip|imageView2/1/w/360/h/240" alt="120"/>
        </a>
      <a class="title" target="_blank" href="www.baidu.com">ç½—æ°¸æµ©æœ€çˆ±çš„â€œè½¯ä»¶â€ä¸‹å‡¡äº†ï¼ è®©ä½ ä½“éªŒé«˜æ•ˆè®°å½•çš„æ„Ÿè§‰</a>
        <a class="nickname" target="_blank" href="/u/00385c37e5de">ToolsæŒ‡å—</a>
            <a target="_blank" href="www.baidu.com#comments">
              <i class="iconfont ic-list-comments"/> 3
    </a>
    _blank
     ç½—æ°¸æµ©æœ€çˆ±çš„â€œè½¯ä»¶â€ä¸‹å‡¡äº†ï¼ è®©ä½ ä½“éªŒé«˜æ•ˆè®°å½•çš„æ„Ÿè§‰ ToolsæŒ‡å— 3




### Xpath&CssSelector
åˆ©ç”¨è¿™äº›è¯­æ³•å®šä½domçš„å…ƒç´ 
F12å¼€å‘è€…æ¨¡å¼ï¼Œç›´æ¥å¤åˆ¶æ³¨æ„jsæ¸²æŸ“ä¼šæ‰°ä¹±xpathå’Œcss

<div align= center><img src="./static/pachong1.png"/></div>


<h3>Xpath</h3>


| ç±»å‹      | å½¢å¼          |
| ------------- | -----:|
|article    |    é€‰å–æ‰€æœ‰articleå…ƒç´ çš„æ‰€æœ‰å­èŠ‚ç‚¹|
|/article    |   é€‰å–æ ¹å…ƒç´ article|
|article/a   |   é€‰å–æ‰€æœ‰å±äºarticleçš„å­å…ƒç´ çš„aå…ƒç´ |
|//div         | é€‰å–æ‰€æœ‰divå­å…ƒç´ ï¼ˆä¸è®ºå‡ºç°åœ¨æ–‡æ¡£ä»»ä½•åœ°æ–¹ï¼‰|
|article//div  | é€‰å–æ‰€æœ‰å±äºarticleå…ƒç´ çš„åä»£çš„divå…ƒç´ ï¼Œä¸ç®¡å®ƒå‡ºç°åœ¨articleä¹‹ä¸‹çš„ä»»ä½•ä½ç½®|
|//@class      |  é€‰åŒºè¿™ä¸ªæ ‡ç­¾ä¸‹æ‰€æœ‰åä¸ºclassçš„å±æ€§|
|/a[@href="link2.html"]|é€‰å–æ‰€æœ‰hrefä¸º"link2.html"çš„aæ ‡ç­¾|
|@href|æ‹¿åˆ°hrefæ ‡ç­¾|
|?/text()|?å…ƒç´ ä¸‹çš„æ–‡æœ¬|

<h3>cssé€‰æ‹©å™¨</h3>

| ç±»å‹      | å½¢å¼          |
| ------------- | -----:|
|*                |é€‰æ‹©æ‰€æœ‰èŠ‚ç‚¹|
|#container       |é€‰æ‹©idä¸ºcontainerçš„èŠ‚ç‚¹|
|.container       |é€‰å–æ‰€æœ‰classåŒ…å«containerçš„èŠ‚ç‚¹|
|li a             |é€‰å–æ‰€æœ‰iä¸‹çš„æ‰€æœ‰aèŠ‚ç‚¹|
|ul+p             |é€‰æ‹©låé¢çš„ç¬¬ä¸€ä¸ªpå…ƒç´ |
|div#container>ul |é€‰å–idä¸ºcontainerçš„divçš„ç¬¬ä¸€ä¸ªulå­å…ƒç´ |
|ul~p             |é€‰å–ä¸ulç›¸é‚»çš„æ‰€æœ‰på…ƒç´ |
|a[title]         |é€‰å–æ‰€æœ‰æœ‰titleå±æ€§çš„aå…ƒç´ |
|a[href="http:/jobbole.com"]        |é€‰å–æ‰€æœ‰hrefå±æ€§ä¸ºjobbole.comå€¼çš„aå…ƒç´ |
|a[href*="jobole"]                 | é€‰å–æ‰€æœ‰hrefå±æ€§åŒ…å«jobboleçš„aå…ƒç´ |
|a[href^="http"]                    |é€‰å–æ‰€æœ‰hrefå±æ€§å€¼ä»¥httpå¼€å¤´çš„aå…ƒç´ |
|a[href$=".jpgâ€]                   | é€‰å–æ‰€æœ‰hrefå±æ€§å€¼ä»¥.jpgç»“å°¾çš„aå…ƒç´ |
|input[type=radio]:checked         | é€‰æ‹©é€‰ä¸­çš„radioçš„å…ƒç´ |
|div:not(#container)               | é€‰å–æ‰€æœ‰idécontainerçš„divå±æ€§|
|li:nth-child(3)                   | é€‰å–ç¬¬ä¸‰ä¸ªiå…ƒç´ |
|tr:nth-child(2n)               | ç¬¬å¶æ•°ä¸ªtr|
|a::text|æ‹¿åˆ°æ ‡ç­¾çš„æ–‡æœ¬|
|a::attr(href)|æ‹¿åˆ°æ ‡ç­¾hrefå±æ€§|


```py
from lxml import etree
html=etree.HTML(dom)#åˆå§‹åŒ–ï¼Œä¹Ÿå¯åˆå§‹åŒ–æœ¬åœ°ç½‘é¡µetree.parse('test.html')
result = etree.tostring(html)#æ”¾å…¥lxmlä¸­
result.decode("utf-8")#å¯¹è¿™ä¸ªhtmlè¿›è¡Œç¼–ç 

x=html.xpath('//div[@class="content"]/text()')
print(x)
y=html.cssselect('#note-36396362 > div >.title')#æ‹¿åˆ°æ‰€æœ‰classä¸ºtitleçš„å…ƒç´ 
for i in y:#æ˜¯ä¸ªåˆ—è¡¨
    print(i.text,i.attrib['href'])
```

:::danger æ³¨æ„
ç©ºæ ¼å’Œæ¢è¡Œç¬¦ä¹Ÿç®—ä¸€ä¸ªæ–‡æœ¬ï¼Œçœ‹ç»“æœ
:::
ç»“æœ



    ['\n  å¬è¯´é”¤å­åˆå‘å¸ƒäº†æ–°äº§å“ï¼ é”¤å­ç§‘æŠ€ä¸æ˜¯ä¸€ä¸ªå–æ‰‹æœºçš„å¥½å…¬å¸ï¼Œ
    å´æ˜¯ä¸€ä¸ªæè½¯ä»¶çš„é¢†å¤´å†›ï¼Œæ——ä¸‹çš„é—ªå¿µèƒ¶å›Šå’ŒBigBangä¸€ç›´è¢«èµæ‰¬ï¼Œç½‘å‹æˆç§°ï¼š
    é”¤å­æœ‰ä¸‰...\n    ', '\n    ', '\n    ', '\n  ']
    ç½—æ°¸æµ©æœ€çˆ±çš„â€œè½¯ä»¶â€ä¸‹å‡¡äº†ï¼ è®©ä½ ä½“éªŒé«˜æ•ˆè®°å½•çš„æ„Ÿè§‰ 
    www.baidu.com



## å­˜å‚¨
### pymysql
- åˆ›å»ºè¿æ¥
å‚æ•°å¦‚ä¸‹
<div align= center><img src="./static/dbpara.png"/></div>

- åˆ›å»ºæ¸¸æ ‡<br/>
å¯é€‰æ‹©å­—å…¸å½¢å¼<br/>
- æ„é€ sqlè¯­å¥<br/>
å–„ç”¨str.format<br/>
- æ‰§è¡Œsql<br/>
æ³¨æ„é”™è¯¯å›æ»š<br/>
- æ‹¿å›ç»“æœ<br/>
æ³¨æ„æŒ‡é’ˆçš„ä½ç½®<br/>
```py
import pymysql

conn=pymysql.connect(host='127.0.0.1',
                    user='root',
                    password='ä¸ç»™çœ‹ï¼ï¼ï¼',
                    database='aiosql',
                    charset='utf8mb4')
cur=conn.cursor(cursor=pymysql.cursors.DictCursor)
#ä½¿ç”¨DictCursorè¿”å›ä¸å†æ˜¯å…ƒç»„æ˜¯ä¸€ä¸ªä»£æ˜ å°„çš„å­—å…¸
sql='select * from aio'
try:
    reslen=cur.execute(sql)#æ‰§è¡Œsqlè¯­å¥
    conn.commit()#æ³¨æ„è¦æäº¤
except:#å‘ç”Ÿé”™è¯¯
    conn.rollback()#å›æ»š
    cur.close()
    conn.close()#å…³é—­
#è¡Œä¸ºå•ä½ç§»åŠ¨
cur.description#å…‰æ ‡è¯¦æƒ…æè¿°
print(cur.lastrowid)#å…‰æ ‡
cur.scroll(2,mode='absolute')#æŒ‡é’ˆæŒ‡å‘ç¬¬äºŒæ¡
cur.scroll(1,mode='relative')#æŒ‡é’ˆç›¸å¯¹å‘åç§»åŠ¨ä¸¤æ¡
one=cur.fetchone()#ç»“æœçš„ä¸€æ¡å…‰æ ‡åç§»1
all=cur.fetchmany(3)#æ‹¿å‡ºä¸‰æ¡åç§»3
many=cur.fetchall()#æ‹¿å‡ºä¸‰æ¡ï¼Œç§»åˆ°åº•
print(one,all,many)
```
:::danger æœ‰å‘
æ’å…¥æ•°æ®åº“è¦ä¿è¯å¥å£®æ€§ï¼Œç‰¹æ®Šå­—ç¬¦æå‰å¤„ç†æ¯”å¦‚å»æ‰å•å¼•å·ï¼Œåæ–œæ ï¼Œç¼–ç å­—ç¬¦ç­‰<br/>
å››å­—èŠ‚å­—ç¬¦å…¥åº“æ—¶\xF0\x9F\x99\x8Fåƒè¿™æ · <br/>
é¦–å…ˆä¿®æ”¹ my.ini ç¼–ç é›†ä¸ºutf8mb4 æ•°æ®åº“å’Œè¡¨æ”¹ä¸ºutf8mb4<br/>
è¿˜ä¸è¡Œçš„è¯åˆ åº“é‡æ–°æ–°å»ºé€‰æ‹©å­—ç¬¦é›†utf8mb4<br/>
è¿æ¥æ•°æ®åº“çš„æ—¶å€™æ”¹ä¸ºutf8mb4é‡å¯mysqldæœåŠ¡
:::

### PyMongo
<strong>*pip install pymongo*</strong><br/>
mongoçš„æ“ä½œçœ‹<a href='/blog/back/æ•°æ®ç›¸å…³.html#mongodb'>è¿™é‡Œ</a>
<h4>è¿æ¥</h4>

ç®€å†™(é»˜è®¤è¿æ¥æœ¬åœ°)<br/>
client=MongoClient()<br/>
æŒ‡å®šç«¯å›—å’Œåœ°å€<br/>
client=MongoClient(localhostï¼Œ27017)<br/>
ä½¿ç”¨URI <br/>
client=MongoClient(mongodb://localhostï¼š27017/")<br/>
client.PORT,client.HOST,client.list_database_names()<br>
db=client.mydb # ä½¿ç”¨mydbï¼Œæ²¡æœ‰å°±è‡ªåŠ¨åˆ›å»º<br/>
myset=db.my_set<br>
:::tip å…³é—­
å…³é—­æ•°æ®åº“çš„æ—¶å€™è°ƒç”¨client.close()ä¹‹åä»ç„¶èƒ½ä½¿ç”¨å±æ€§ï¼Œæ¯”å¦‚åœ¨æ‰“å°ä¸€æ¬¡ä¹Ÿèƒ½æ‰“å°å‡ºæ¥ï¼Œyinweimongoé»˜è®¤æœ‰ä¸ªè¿æ¥æ± ï¼Œåªè¦æ²¡æ»¡éšæ—¶éƒ½èƒ½è¿
:::
<h4>å¢åˆ æ”¹æŸ¥</h4>

- æ’å…¥<br/>
<strong> *my_set.insert([{"name":"zhangsan","age":18},{"name":"lilin","age":18}])* </strong><br/>
<strong> *my_set.save({"name":"zhangsan","age":18})* </strong><br>
saveçš„æ—¶å€™ä»–ä¼šéå†ï¼Œä½†æ˜¯insertä¸ä¼šï¼Œæ‰€ä»¥insertå¿«ä¸€äº›<br/>
- æŸ¥è¯¢è¿™ä¸ªé›†åˆæ‰€æœ‰çš„æ•°æ®(éœ€è¦ç”¨foréå†)
<strong> *my_set.find()* </strong><br>
- æŸ¥æ‰¾åå­—ä¸ºzhangsançš„æ•°æ®(éœ€è¦ç”¨foréå†)<br/>
<strong> *my_set.find({"name":"zhangsan"})* </strong><br>
- å–å‡ºè¿™æ¡è®°å½•çš„'id'ä¾æ­¤ç±»æ¨å¯ä»¥å¾€åå–<br>
<strong> *id=my_set.find({"name":"zhangsan"})['id']* </strong><br>
- ç§»é™¤è¿™ä¸ªè®°å½•çš„id<br>
<strong> *my_set.remove(id)* </strong><br>
- æŠŠnameä¸ºzhangsançš„ageæ”¹ä¸º20<br/>
<strong> *my_set.update({"name":"zhangsan"},{'$set':{"age":20}})* </strong><br>
- ç§»é™¤å¼ ä¸‰è¿™ä¸ªæ•°æ®çš„å…¨éƒ¨è®°å½•<br>
<strong> *my_set.remove({'name': 'zhangsan'})* </strong><br>
- åˆ æ‰è¿™ä¸ªåº“<br/>
<strong> *db.remove()* </strong><br>

<h4>æ“ä½œå’ŒæŸ¥è¯¢ç¬¦</h4>

1. æŸ¥è¯¢ç¬¦
    - \>  å¤§äº - $gt
    - <  å°äº - $lt
    - \>=  å¤§äºç­‰äº - $gte
    - <=  å°äºç­‰äº - $lte

- ageå¤§äº25çš„è®°å½•
<strong> *my_set.find({"age":{"$gt":25}})* </strong><br>
2. ç±»å‹åˆ¤æ–­<br/>
å‘ç°å­—ç¬¦ä¸²ç±»å‹çš„name<br/>
<strong> *my_set.find({'name':{'$type':2}})* </strong><br>
<div align=center>ç±»å‹å¯¹ç…§è¡¨<br></div><br>

| ç±»å‹      | ç           |
| ------------- | -----:|
|Double         |   ç±»å‹ä»£ç  1|
|String    |   ç±»å‹ä»£ç  2|
|Object   |   ç±»å‹ä»£ç  3|
|Array         | ç±»å‹ä»£ç  4|
|Binary data   | ç±»å‹ä»£ç  5|
|Boolean    |  ç±»å‹ä»£ç  8|
|Date   | ç±»å‹ä»£ç  9|
|Null    |ç±»å‹ä»£ç  10|
|Regular Expression |   ç±»å‹ä»£ç  11|
|JavaScript  |  ç±»å‹ä»£ç  13|
|Symbol   | ç±»å‹ä»£ç  14|
|JavaScript (with scope)  |  ç±»å‹ä»£ç  15|
|32-bit integer  |  ç±»å‹ä»£ç  16|
|Timestamp   | ç±»å‹ä»£ç  17|
|64-bit integer   | ç±»å‹ä»£ç  18|
|Min key   | ç±»å‹ä»£ç  255|
|Max key   | ç±»å‹ä»£ç  127|

3. æ¡ä»¶æŸ¥è¯¢

- æ’åº<br/>
ageå‡åºæŸ¥è¯¢<br>
<strong> *my_set.find().sort([("age",1)])* </strong><br>
- è¯»å–
è·³è¿‡ä¸¤æ¡ä¹‹åè¯»å…­æ¡<br/>
<strong> *my_set.find().skip(2).limit(6)* </strong><br>

- in<br/>
å‘ç°å¹´é¾„ï¼ˆ20ï¼Œ30ï¼Œ53ï¼‰ä¸­çš„æ•°æ®<br/>


<strong> *my_set.find({"age":{"$in":(20,30,35)}})* </strong><br>
- or<br/>

å‘ç°ageæ˜¯20æˆ–35çš„æ•°æ®
<br/>


<strong> *my_set.find({"$or":[{"age":20},{"age":35}]})* </strong><br>
- all<br/>
æŸ¥è¯¢åºåˆ—çš„åŒ…å«<br/>

dic = {"name":"xiahong","age":18,"li":[1,2,3]}<br/>
dic2 = {"name":"xiaoming","age":18,"li":[1,2,3,4,5,6]}<br/>

<strong> *my_set.find({'li':{'$all':[1,2,3,4]}})* </strong><br>
ç»“æœåªä¼šå‡ºç°dic2
- push[ALL]
æ›´æ”¹åºåˆ—<br/>
å•ä¸ªå€¼: my_set.update({'name':"xiaohong"}, {'$push':{'li':[4]}})<br/>
å¤šä¸ªè¿½åŠ : my_set.update({'name':"xiaohong"}, {'$pushAll':{'li':[4,5]}})<br/>
dic = {"name":"xiahong","age":18,"li":[1,2,3,4,4,5]}
- pop/pullAll
å•ä¸ªå€¼: my_set.update({'name':"xiaohong"}, {'$pop':{'li':[4]}})<br/>
å»é™¤å¤šä¸ª: my_set.update({'name':"xiaohong"}, {'$pullAll':{'li':[4,5]}})<br/>
dic = {"name":"xiahong","age":18,"li":[1,2,3]}
- å¤šçº§ç›®å½•æ“ä½œ<br/>
å–çš„æ—¶å€™ç”¨.è¿æ¥ï¼Œç»“æœç”¨['å­—å…¸è°ƒç”¨']æ–¹å¼è¿æ¥<br/>
æŸ¥æ‰¾aå±æ€§çš„bå±æ€§çš„cå±æ€§å€¼ä¸º5çš„æ•°æ®<br/>
<strong> *my_set.find(a.b.c:5)* </strong><br>
æ‹¿åˆ°ç»“æœçš„aå±æ€§çš„bå±æ€§çš„cå±æ€§å€¼<br/>
<strong> *res['a']['b']['c']* </strong><br>
:::tip æç¤º
update,$setç­‰ä¹Ÿæ˜¯è¿™ä¹ˆå¯»æ‰¾
:::
### redis
<h4>pip install redis</h4><br/>

<h4>è¿æ¥</h4>
<h4>è¿æ¥</h4>
<h4>è¿æ¥</h4>
<h4>è¿æ¥</h4>
<h4>è¿æ¥</h4>

### aiomysql
ä¾èµ–<br>
- Python3.5+
- asyncio
- PyMySQL<br>
eventloop+while Trueæ¨¡å¼è¿›è¡Œæ’å…¥å¼‚æ­¥è¿›è¡Œ

```py
import asyncio
from aiomysql import create_pool

import aiohttp

loop=asyncio.get_event_loop()

async def go():
    async with create_pool(host='127.0.0.1',port=3306,user='root',password='1118',db='aiosql',charset='utf8mb4',loop=loop) as pool:
        async with pool.acquire() as conn:#è·å¾—pool
            async with conn.cursor() as cur:#åˆ›å»ºæ¸¸æ ‡
                for i in range(100):#å¼‚æ­¥è¿è¡Œäº†ä¸€ç™¾æ¬¡è¿™ä¸ªsqlè¯­å¥
                    await cur.execute('select * from aio limit 1;')
                    value= await cur.fetchone()
                    print(value)

loop.run_until_complete(go())
```
é€šè¿‡è¿æ¥æ± æ¥è¿æ¥
```py
async def test(loop):
    pool=await create_pool(host='127.0.0.1',port=3306,user='root',password='1118',db='aiosql',charset='utf8mb4',loop=loop)
    async with pool.acquire() as conn:
        async with conn.cursor() as cur:
            for i in range(1000000):
                await cur.execute('select * from aio limit 1;')
                print(cur.description)
                (r,)=await cur.fetchone()
                print(r)
    pool.close()
    await pool.wait_closed()

loop=asyncio.get_event_loop()
loop.run_until_complete(test(loop))
```



## Scrapy
çœ‹<a href='/blog/back/python/scrapy%E7%9B%B8%E5%85%B3.html'>è¿™é‡Œ</a>æˆ–è€…ä¸‹ä¸€ç¯‡
<Valine></Valine>
